{% extends 'base.html' %}

{% block content %}
<div class="quiz-container">
    <!-- Header -->
    <header class="quiz-header">
        <a href="{{ url_for('index') }}" class="back-btn">
            <span class="back-icon">‚Üê</span>
            <span>Mappa</span>
        </a>
        <div class="quiz-title-header">
            <span class="quiz-level">Quiz Livello {{ recipe.id }}</span>
            <h1>{{ recipe.name }}</h1>
        </div>
        <a href="{{ url_for('recipe', recipe_id=recipe.id) }}" class="skip-btn" id="skipQuizBtn">
            Salta Quiz ‚Üí
        </a>
    </header>

    <!-- Progress Bar -->
    <div class="quiz-progress-container">
        <div class="quiz-progress-bar">
            <div class="quiz-progress-fill" id="progressFill" style="width: 20%;"></div>
        </div>
        <span class="quiz-progress-text" id="progressText">Domanda 1 di {{ questions|length }}</span>
    </div>

    <!-- Quiz Info Banner (if already completed) -->
    {% if quiz_already_done %}
    <div class="quiz-info-banner">
        <span>üîÑ</span>
        <span>Hai gi√† completato questo quiz! Miglior punteggio: {{ best_score }}/{{ questions|length }}. Puoi riprovare
            ma non guadagnerai altri XP.</span>
    </div>
    {% endif %}

    <!-- Quiz Card Container -->
    <main class="quiz-main">
        <div class="quiz-card" id="quizCard">
            <!-- Question will be rendered by JS -->
        </div>
    </main>

    <!-- Results Screen (hidden initially) -->
    <div class="quiz-results hidden" id="quizResults">
        <div class="results-card">
            <div class="results-icon" id="resultsIcon">üéâ</div>
            <h2 id="resultsTitle">Quiz Completato!</h2>
            <div class="results-score">
                <span class="score-number" id="scoreNumber">0</span>
                <span class="score-label">/ {{ questions|length }}</span>
            </div>
            <div class="results-xp" id="resultsXp">
                <span class="xp-badge">+0 XP</span>
            </div>
            <p class="results-message" id="resultsMessage">Ottimo lavoro!</p>
            <div class="results-buttons">
                <a href="{{ url_for('recipe', recipe_id=recipe.id) }}" class="btn-primary" id="goToRecipeBtn">
                    üç∞ Vai alla Ricetta
                </a>
                <button class="btn-secondary" id="retryQuizBtn">
                    üîÑ Riprova Quiz
                </button>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti-container hidden" id="confettiContainer"></div>
</div>

<!-- Pass data to JavaScript via data attributes -->
<div id="quizConfig" data-recipe-id="{{ recipe.id }}" data-recipe-name="{{ recipe.name }}"
    data-already-done="{{ 'true' if quiz_already_done else 'false' }}" style="display: none;">
</div>

<script>
    // Initialize from data attributes
    const config = document.getElementById('quizConfig').dataset;
    window.QUIZ_DATA = {
        recipeId: parseInt(config.recipeId),
        recipeName: config.recipeName,
        quizAlreadyDone: config.alreadyDone === 'true'
    };
</script>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/quiz.js') }}"></script>
{% endblock %}